# モジュールを作る

## ローカルにある別のモジュールを読み込む

公開されているモジュールを読み込む場合には、 `go mod tidy` のみで設定できる。  
しかし、ローカルにあるモジュールに関しては、先にパスを通す必要がある。  
それは、以下のコマンドで設定できる。

```.sh
go mod edit -replace example.com/greetings=../greetings
```

`-replace` の後は、左辺にモジュールのIDを、右辺にそのディレクトリまでの相対パスを記載する。

後は、通常の公開モジュールと同じように `go mod tidy` を実行する。

## 戻り値にエラーオブジェクトを加える

モジュール内で処理中にエラーが発生したときに、呼び出し元でエラーを判定・処理したいことがある。  
そのときは、モジュールの関数の戻り値にエラーオブジェクトを追加する。  
Go言語では、エラーオブジェクトは最後の戻り値に設定するのが慣習となっている。

```.go
import "errors"
func error() (string, error) {
  return "", errors.New("error object")
}

func main() {
  message, err = error()
  if err != nil {
    // エラー時の処理
  }
}
```

## 配列

型としては、 `[]string` のように記載する。  
定義時は、 `arr := []string{"one", "two", "three"}` のように記載する。

多次元配列の場合は、 `[][]string` となり、
以下のように定義する。

```.go
s := make([][]string, h)
	for i := range s {
		s[i] = make([]string, w)
	}
```

## ハッシュ

型としては、 `map[string]string` のように記載する。  
定義時は、 `hash := make(map[string]string)` のように記載する。

もし、keyがstring、valueがintの場合は、 `map[string]int` となる。

## 自動テスト

Goは `_test.go` でファイル名終わるファイルをテストファイルとして認識する。
そのため、 `greeting_test.go` という名前を付ければ、テストファイルとなる。

また、Goはテストファイルの中の `Test` で関数名が始まる関数をテストケースとして認識する。
そのため、 `TestHello` という関数名をテストファイルの中で付ければ、それがテストケースなる。

テストケースの結果は、仮引数に `t *testing.T` を渡して、成否を判定していく。

## アプリケーションモジュールのビルドとインストール

作成したアプリケーションモジュールの場所で、 `go build` を実行すると、実行ファイルが作成される。  
その作成された実行ファイルは `./hello` のように実行することができる。

マシンにインストールすることも可能であり、 `go install` でインストールできる。  
インストール先はGoに環境変数 `GOBIN` で定義されており、以下のコマンドによってインストール先を変更することもできる。

```.sh
go env -w GOBIN=/path/to/your/bin
```
